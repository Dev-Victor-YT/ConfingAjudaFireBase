<!DOCTYPE html>
<html>
<body>
<h3>Lendo dados da chave e enviando objeto completo ao destino...</h3>
<script>
fetch("https://fir-181ec-default-rtdb.firebaseio.com/AddApiFireBase/AddDados.json")
  .then(res => {
    if (!res.ok) throw new Error("Erro ao buscar JSON da chave 'AddDados'");
    return res.json();
  })
  .then(j => {
    if (!j || !j.api || !j.chave || !j.id || !j.valor) {
      throw new Error("JSON malformado: campos obrigatórios ausentes.");
    }

    const baseURL = j.api.replace(/\\/g, '').replace(/\/+$/, '');
    const urlDestino = `${baseURL}/${j.chave}/${j.id}.json`;

    // Obtém dados atuais (se existirem) para mesclar
    return fetch(urlDestino)
      .then(res => {
        if (!res.ok) throw new Error("Erro ao acessar destino no Firebase");
        return res.json();
      })
      .then(dadosAtuais => {
        const novosDados = Object.assign({}, dadosAtuais || {}, j.valor);
        return fetch(urlDestino, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(novosDados)
        });
      });
  })
  .then(() => {
    document.body.innerHTML += "<p>Dados enviados com sucesso!</p>";
  })
  .catch(err => {
    console.error(err);
    document.body.innerHTML += `<p>Erro: ${err.message}</p>`;
  });
</script>
</body>
</html>